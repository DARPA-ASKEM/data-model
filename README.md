# ASKEM Data Store API

## Usage

The API can be started by simply calling

```
docker compose up
```

Run the following command instead to start the data service api and a postgresql docker container
```
docker compose up
```
(Please note that any changes in the `tds/autogen` directory
will forbid the API from starting.)

## Development

The requirements for developing this project locally are [Poetry](https://python-poetry.org/) and Docker.

Initialize the project using the following commands:
```
git clone git@github.com:DARPA-ASKEM/data-service.git
cd data-service
poetry install
poetry run pre-commit install
```

To start the server in a docker container, run:
```
docker compose up
```
which will also start a development instance of Postgres.

The server will not start if the generated model files are dirty i.e.
out of sync data model version or a non-autogenerated change to the
file contents. (Version is tracked using the DBML project `Note`).
The Jataware Python package [dbml-builder](https://pypi.org/project/dbml-builder/)
handles the code generation.

To generate new model files, run:
```
poetry run model-build generate ./askem.dbml ./tds/autogen
```

and check if they are valid by running

```
model-build check [current semantic version] ./src/autogen
```

Where [current semantic version] is the version of your dbml - ex. v0.11.3 . If the tables don't exist yet it in Postgres, make sure to POST to the `/admin/db/init` endpoint.

## ASKEM Data Model

![The generated graphic](./docs/assets/askem.png)

ERD was created using [DBML](https://www.dbml.org/home/) and rendered and edited using [dbdiagram](https://dbdiagram.io/)
